---
title: Auditing
keywords: structured, rest, documentreference
tags: [rest,fhir,api,noccprofile]
sidebar: accessrecord_rest_sidebar
permalink: integration_auditing.html
summary: "Overview of audit and provenance requirements for data transported over NRL FHIR and SSP interfaces."
---

{% include custom/search.warnbanner.html %}


## Overview ##

Consumers and Providers are required to keep an audit of requests to and responses from the NRL API interfaces.

Consumers and Providers are required to keep an audit of requests and responses related to the retrieval of records and documents.

In addition to this there is a requirement for the NRL and SSP to keep an audit of requests and responses that flow through these sevices.

## Consumers ##

Consumers MUST keep an audit of the requests to and responses from the NRL.

Consumers MUST keep an audit of the requests they make to retrieve a record or document from a Provider system.

Consumers MUST keep an audit of the responses they recieve from a request to retrieve a record or document from a Provider system.

These MUST include all details of the HTTP request that is made including all HTTP Header values.

## Providers ##

Providers MUST keep an audit of the requests to and responses from the NRL.

Providers MUST keep an audit of the requests they receive from Consumers to retrieve a record or document from their system.

Providers MUST keep an audit of the responses they send in response to requests they receive from Consumers to retrieve a record or document from their system.

This MUST include all details of the HTTP request that is made including all HTTP Header values.

It is not necessary for a Provider to keep an audit trail of the response payload that is returned to Consumers; however Providers MUST be able to provide details of the record returned if required for medico-legal purposes. 

## SSP Trace ID ##

The SSP Trace ID is a unique identifier for a request which is generated by the Consumer and included in the SSP-TraceID HTTP Header for record/document retrieval requests. The SSP Trace ID is for the purpose of auditing and support. 

Consumers and Providers MUST audit this value to enable an end-to-end audit trail of a retrieval request and the associated response. 

## Access Tokens (JWT) ##

Consumers and Providers MUST generate and supply an access token (JWT) with each request they initiate using the standard HTTP Authorization header. Details of these requirements can be found on the [Access Token](integration_access_tokens_JWT.html) page. 

Any request to the NRL or SSP that does not supply an Authorization header that conforms to these requirements will be rejected. 

## Audit Logs ##

The following tables detail what information each actor (Consumer/Provider/NRL/SSP) MUST record in their audit logs. For details of each require attribute, see the [Audit Log Attribute table](#audit-log-attribute) below.

### Provider Pointer Maintenance ###

Providers MUST record the following in audit logs for each NRL maintenance interaction (POST, PATCH, DELETE).

#### For requests to NRL ####

- User ID
- ASID
- ODS Code
- Request Datetime
- NHS Number
- Request URL
- Request HTTP verb
- Request Body (POST and PATCH only)

#### For responses from NRL ####

- Response Outcome
- Message
- Response Datetime

### Provider Document/Record Retrieval ###

Providers MUST record the following in audit logs for each Document/Record retrieval request from a Consumer via the SSP.

#### For requests from Consumers ####

- User ID
- ASID
- ODS Code
- Request Datetime
- Trace ID
- Record version or equivalent
- Record URL
- Response Outcome

### Consumer Pointer Search/Read ###

Consumers MUST record the following in audit logs for each NRL search interaction (GET).

#### For requests to NRL ####

- User ID
- ASID
- ODS Code
- Request Datetime
- NHS Number
- Request URL
- Request HTTP verb

#### For responses from NRL ####

- Response Outcome
- Message
- Response Datetime

### Consumer Document/Record Retrieval ###

Consumers MUST record the following in audit logs for each Document/Record retrieval request to a Provider via the SSP.

#### For requests to Providers ####

- User ID
- ASID
- ODS Code
- Request Datetime
- NHS Number
- Trace ID
- Pointer Logical ID

#### For responses from Providers ####

- Response Outcome
- Message (if the request failed)
- Response Datetime

### NRL Service Pointer Interactions ###

The NRL service MUST record the following in audit logs for each NRL pointer interaction from a Consumer/Provider.

#### For requests to the NRL ####

- User ID
- ASID
- ODS Code
- Request Datetime
- NHS Number
- roleProfileID
- interactionID
- interactionName
- Service

### SSP Document/Record Retrieval Interactions ###

The SSP MUST record the following in audit logs for each interaction.

#### For requests from a Consumer ####

- User ID
- ASID
- ODS Code
- Request Datetime
- Trace ID

#### For responses from a Provider ####

- Response Outcome
- Response Datetime


### Audit Log Attributes ###

The following table details the audit log attributes and the source of the value for the attribute.

| Attribute | Source |
| -------- | ----------------------------------------------------------- |
| ASID | `requesting_system` from JWT. Only the ASID portion is required e.g. https://fhir.nhs.uk/Id/accredited-system\|[ASID] |
| Request Datetime | Datetime that audit log was written |
| NHS Number | This is taken from the value of the subject (e.g. https://demographics.spineservices.nhs.uk/STU3/Patient/[NHS_Number]) which may exist as an attribute or a parameter depending on the action being performed as per below.<br><br>POST (create / supersede)<br>The patient NHS Number defined in the `subject` attribute of the DocumentReference that makes up the HTTP request body<br><br>GET (search)<br>The patient NHS Number defined in the HTTP Parameter `subject`<br><br>PATCH (update)<br>The patient NHS Number defined in the `subject` attribute of the DocumentReference being 'patched'<br><br>DELETE (delete)<br>The patient NHS Number defined in the `subject` attribute of the DocumentReference being 'deleted' |
| ODS Code | `requesting_organization` from JWT. Only the ODSCode portion is required e.g. https://fhir.nhs.uk/Id/ods-organization-code\|[ODSCode] |
| interactionName | NRLSREGISTER_REQUEST for HTTP POST,  NRLSDISCOVER_REQUEST for HTTP GET, NRLSREMOVE_REQUEST for HTTP DELETE |
| interactionID | NRLSREGISTER_REQUEST for HTTP POST,  NRLSDISCOVER_REQUEST for HTTP GET, NRLSREMOVE_REQUEST for HTTP DELETE |
| roleProfileID | `requesting_user` from JWT. This will be 'NotProvided' if requesting_user isn't available in JWT. |
| Pointer Logical ID | The Logical ID of the pointer (generated by the NRL) from which the retrieval request has been made |
| Request Body | HTTP Request Body (where applicable i.e. POST or PATCH) | 
| Request HTTP verb | POST, PATCH, GET or DELETE |
| Request URL | URL of the NRL service that was called |
| Record URL | URL of the record that was provided in response to the document/record retrieval request. This is the same as the `content.attachment.url` property defined on the associated NRL pointer. |
| Trace ID | The Consumer generated ID of the retrieval request |
| User ID | `requesting_user` from JWT. This will be 'NotProvided' if requesting_user isn't available in JWT.<br>This is not mandatory where the request is completed as a non-interactive process |
| Service | `urn:nhs:names:services:nrls` |
| Response Message | HTTP Response Body |
| Response Datetime | Datetime that the response was recieved from NHS Digital service (NRL or SSP) |
| Response Outcome | HTTP status code (Success: 2xx \| Fail: 4xx or 5xx) |
| Record version or equivalent | Reference to the version ID (or equivalent) from which the NRL Provider can identity what version of a record was provided |
