---
title: Auditing
keywords: structured rest documentreference
tags: [integration,auditing,fhir,spine_secure_proxy]
sidebar: accessrecord_rest_sidebar
permalink: integration_auditing.html
summary: Overview of audit and provenance requirements for data transported over NRL FHIR and SSP interfaces.
---

## Overview

Consumers and providers are required to keep an audit trail of:
- requests to and responses from the NRL API interfaces.
- requests and responses related to the retrieval of records and documents.

In addition, the NRL and SSP are required to keep an audit trail of requests and responses that flow through these services and providers may request audit trail data from NHS Digital about any pointers they own/maintain.

## Consumers

Consumers **MUST** keep an audit trail of:
- requests to and responses from the NRL.
- requests to and responses from provider systems (to retrieve records/documents etc.)

## Providers

Providers **MUST** keep an audit trail of:
- requests to and responses from the NRL.
- requests received from consumers (to retrieve records/documents etc.) **and** their corresponding responses*\**.

\* *It is not necessary for a provider to keep an audit trail of the response payload returned to consumers, however, providers **MUST** be able to provide details of the record returned if required for medico-legal purposes.*

## SSP Trace ID

The SSP Trace ID is a unique identifier for a request that is generated by the consumer and included in the `SSP-TraceID` HTTP header for record retrieval requests. The SSP Trace ID is for the purpose of auditing and support.

Consumers and providers **MUST** audit this value to enable an end-to-end audit trail of a retrieval request and the associated response.

## Access Tokens (JWT)

Consumers and providers **MUST** generate and supply a JWT access token with each request they initiate using the standard `Authorization` HTTP header. Details of these requirements can be found on the [JSON Web Token Guidance](jwt_guidance.html) page.

Any request to the NRL or SSP that does not supply an `Authorization` HTTP header conforming to these requirements will be rejected.

## Audit Logs

The following sections detail what information each actor (Consumer/Provider/NRL/SSP) **MUST** record in their audit logs. For details of each required attribute, see the [Audit Log Attributes table](#audit-log-attributes) below.

### Provider Pointer Maintenance

Providers **MUST** record the following in audit logs for each NRL maintenance interaction (POST, PATCH, DELETE):

|For requests to the NRL|For responses from the NRL|
|-----------------------|--------------------------|
|ASID<br />HTTP Request Body (for POST and PATCH only)<br />HTTP Request URL<br />HTTP Verb<br />ODS Code<br />NHS Number<br />Request Datetime<br />User ID|HTTP Response Body<br />HTTP Status Code<br />Response Datetime|

### Provider Document/Record Retrieval

Providers **MUST** record the following in audit logs for each record retrieval request from a consumer via the SSP:

|For requests from consumers|
|---------------------------|
|ASID<br />HTTP Request URL<br />HTTP Status Code<br />ODS Code<br />Record version or equivalent<br />Request Datetime<br />Trace ID<br />User ID|

### Consumer Pointer Search/Read

Consumers **MUST** record the following in audit logs for each NRL search interaction (GET):

|For requests to the NRL|For responses from the NRL|
|-----------------------|--------------------------|
|ASID<br />HTTP Request URL<br />HTTP Verb<br />ODS Code<br />NHS Number<br />Request Datetime<br />User ID|HTTP Response Body<br />HTTP Status Code<br />Response Datetime|

### Consumer Document/Record Retrieval

Consumers **MUST** record the following in audit logs for each document/record retrieval request to a provider via the SSP:

|For requests to providers|For responses from providers|
|-------------------------|----------------------------|
|ASID<br />HTTP Request URL<br />NHS Number<br />ODS Code<br />Pointer Logical ID<br />Request Datetime<br />Trace ID<br />User ID|HTTP Response Body (if the request failed)<br />HTTP Status Code<br />Response Datetime|

### Audit Log Attributes

The following table details the audit log attributes and the source of the value for the attribute.

|Attribute|Source|
|---------|------|
| ASID | `requesting_system` from JWT (only the ASID portion is required, for example, `https://fhir.nhs.uk/Id/accredited-system\|[ASID]`). |
| HTTP Request Body | HTTP request body (where applicable, i.e. POST or PATCH). | 
| HTTP Request URL | For example, the URL of the NRL service that was called, or the URL used for the record retrieval request, which includes the value of the `content.attachment.url` property defined on the associated NRL pointer. |
| HTTP Response Body | Response message. |
| HTTP Status Code | Describes the response outcome (Success: 2xx \| Fail: 4xx or 5xx). |
| HTTP Verb | POST, PATCH, GET or DELETE. |
| NHS Number | This is the value used as part of the pointer subject reference (for example, `https://demographics.spineservices.nhs.uk/STU3/Patient/[nhsNumber]`) which may be an attribute on the pointer or a search query parameter depending on the action being performed. |
| ODS Code | `requesting_organization` from JWT (only the ODSCode portion is required, for example, `https://fhir.nhs.uk/Id/ods-organization-code\|[odsCode]`). |
| Pointer Logical ID | The logical ID of the pointer (generated by the NRL) from which the retrieval request has been made. |
| Record version or equivalent | Reference to the `versionId` (or equivalent) from which the NRL provider can identity what version of a record was provided. |
| Request Datetime | Datetime that audit log was written. |
| Response Datetime | Datetime that the response was received from NHS Digital service (NRL or SSP). |
| Trace ID | The consumer-generated ID of the retrieval request. This is only used for requests via the SSP and is for use in the `Ssp-TraceID` HTTP request header. |
| User ID | `requesting_user` from JWT (this will be 'NotProvided' if `requesting_user` isn't available in the JWT.)<br /><br />This is not mandatory where the request is completed as a non-interactive process. |

## Requesting an Audit Trail

Providers can request the following two types of audit trail data from NHS Digital:
* All audit trails for a given patient (identified by their NHS number).
* All audit trails for all pointers owned by the provider.

In either case, the provider is permitted to view audit trail information only for pointers that it owns and maintains.
