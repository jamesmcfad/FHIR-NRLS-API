<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Access token required for interacting with the NRL and SSP.">
<meta name="keywords" content="integrationsecurityauthorisationspine_secure_proxy,  spine ssp integration provenance">
<title>Access Tokens (JWT) | NRL</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="FHIR-NRLS-API" href="https://developer.nhs.uk/apis/nrl/feed.xml">





    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> NRL API | FHIR&reg;</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="Search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Access Tokens (JWT)">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                








<ul id="mysidebar" class="nav">

    <!-- <p style="font-size:2em;">-->

       <!-- <img src="images/interopen.png" height="48px" alt="INTEROpen Logo"/>
    INTEROPen</p>
    <p style="font-size:16px;">Supported by -->
    <img src="images/logo.png"   alt="NHS Digital Logo"/>
    <!--</p>-->


    <li class="sidebarTitle">NRL 2.3.0-beta API <i>specification</i></li>
    
    
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="overview_guide_versioning.html">Product Versioning</a></li>
            
            
            
            
            
            
            <li><a href="overview_release_notes.html">Release Notes</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Solution</a>
        <ul>
            
            
            
            <li><a href="overview_concepts.html">Concepts</a></li>
            
            
            
            
            
            
            <li><a href="overview_behaviours.html">Behaviour</a></li>
            
            
            
            
            
            
            <li><a href="overview_principles.html">Principles</a></li>
            
            
            
            
            
            
            <li><a href="overview_data_model.html">Data model</a></li>
            
            
            
            
            
            
            <li><a href="overview_interactions.html">Interactions</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">General Guidance</a>
        <ul>
            
            
            
            <li><a href="pointer_identity.html">Pointer Identity</a></li>
            
            
            
            
            
            
            <li><a href="pointer_errors.html">Pointer Errors</a></li>
            
            
            
            
            
            
            <li><a href="pointer_lifecycle.html">Pointer Lifecycle</a></li>
            
            
            
            
            
            
            <li><a href="pointer_maintenance.html">Pointer Maintenance</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Development Guidance</a>
        <ul>
            
            
            
            <li><a href="explore.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="development_general_api_guidance.html">General API Guidance</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">DocumentReference API Interactions</a>
                <ul>
                    
                    
                    
                    <li><a href="api_interaction_create.html">Create</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_supersede.html">Create (Supersede)</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_update.html">Update</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_delete.html">Delete</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_read.html">Read</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_search.html">Search</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Record Retrieval Guidance</a>
                <ul>
                    
                    
                    
                    <li><a href="retrieval_overview.html">Overview</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_interaction_read.html">Read Interaction</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_consumer_guidance.html">Consumer Guidance</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_provider_guidance.html">Provider Guidance</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_formats.html">Formats</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
            
            
            <li><a href="explore_reference.html">FHIR Profile Reference</a></li>
            
            
            
            
            
            
            <li><a href="explore_fhir_open_source_guidance.html">FHIR Open-Source Resources</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Integrate With Spine</a>
        <ul>
            
            
            
            <li><a href="integration_authentication_authorisation.html">Authentication &amp; Authorisation</a></li>
            
            
            
            
            
            
            <li><a href="explore_rbac_mapping.html">Access Control</a></li>
            
            
            
            
            
            
            <li><a href="development_api_security_guidance.html">Security</a></li>
            
            
            
            
            
            
            <li class="active"><a href="integration_access_tokens_JWT.html">Access Tokens (JWT)</a></li>
            
            
            
            
            
            
            <li><a href="integration_auditing.html">Auditing</a></li>
            
            
            
            
            
            
            <li><a href="integration_personal_demographics_service.html">Personal Demographics Service</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
        
            <li><a href="/assure.html">Assure</a></li>
        
    
        
    
    <li>
        <a href="#">Help &amp; Support</a>
        <ul>
            
            
            
            <li><a href="support_faq.html">Frequently Asked Questions (FAQ)</a></li>
            
            
            
            
            
            
            <li><a href="support_communications.html">Communication Channels</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
        
            <li><a href="/tags.html">Tags</a></li>
        
    
        
    
        
            <li><a href="/overview_glossary.html">Glossary</a></li>
        
    
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    <!--</li>-->
</ul>
<!--</div>-->

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-header">
   <h1 class="post-title-main">Access Tokens (JWT)</h1>
</div>

<script>
    $(function() {
        $('a[href^="http://"], a[href^="https://"]')
            .attr('target', '_blank') // open all external links in new tab
            .attr('rel', 'noopener noreferrer'); // https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/
    });
</script>



<div class="post-content">

   
    <div class="summary">Access token required for interacting with the NRL and SSP.</div>
   

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.
<!-- removed h3 and h4 from toc KGM 10/JULY/2017 -->
$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

  <div markdown="span" class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> <b>Important:</b> This site is under active development by NHS Digital and is intended to provide all the technical resources you need to successfully develop with the National Record Locator API. This project is being developed using an agile methodology, so iterative updates to content will be added on a regular basis.</div>

  <h2 id="access-tokens-jwt">Access Tokens (JWT)</h2>

<p>Clients MUST send an access token (<a href="overview_glossary.html#jwt" data-toggle="tooltip" title="JSON web token, a standard for access tokens containing information about authorisation claims.">JWT</a>) with each request to the NRL or the SSP using the standard HTTP Authorization request header. The JWT MUST conform to the <a href="https://developer.nhs.uk/apis/spine-core/security_jwt.html">Spine JWT</a> definition.</p>

<p>The claims of the JWT are the same as those defined in the Spine Core JWT. However, the rules that govern the validation of those claims are different. From an NRL perspective, the rules defined here override rules defined for the Spine Core.</p>

<p>Where a Spine Core rule is not explicitly replaced here, the Spine Core rule stands.</p>

<h3 id="claims">Claims</h3>

<p>In the Spine JWT definition, the <code class="highlighter-rouge">requesting_organisation</code> claim is marked as optional. However, this claim MUST be supplied for all NRL and SSP requests.</p>

<h3 id="validation">Validation</h3>

<p>Depending upon the client’s role (Provider or Consumer) the validation that is applied to the JWT varies. The following section is broken down into three parts:</p>

<ol>
  <li>Common – validation that is common across Providers and Consumers</li>
  <li>Provider – validation rules that only apply where the client is a Provider</li>
  <li>Consumer – validation rules that only apply where the client is a Consumer</li>
</ol>

<h4 id="common-validation">Common Validation</h4>

<p>Where there has been a validation failure, the following response will be returned to the client. In all instances, the response will be the same. However, the diagnostics text will vary depending upon the nature of the error.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>structure</td>
      <td>MISSING_OR_INVALID_HEADER</td>
      <td>There is a required header that is missing or invalid</td>
      <td><strong>Note:</strong> See <a href="integration_access_tokens_JWT.html#missing_or_invalid_header-exception-scenarios">MISSING_OR_INVALID_HEADER Exception Scenarios</a></td>
    </tr>
  </tbody>
</table>

<h4 id="missing_or_invalid_header-exception-scenarios">MISSING_OR_INVALID_HEADER Exception Scenarios:</h4>

<p>Example 1: JWT missing – the Authorization header has not been supplied. The following response MUST be returned to the client.</p>

<p><em>Diagnostics - The Authorisation header must be supplied</em></p>

<!--
| HTTP Code | issue-severity | issue-type | Details.Code | Details.Display | Diagnostics |
|-----------|----------------|------------|--------------|-----------------|-------------------|
|400|error|<font color="red">structure</font> |MISSING_OR_INVALID_HEADER|There is a required header missing or invalid|The Authorisation header must be supplied|

Diagnostics - The Authorisation header must be supplied-->

<p>Example 2: JWT structure invalid – the Authorization header is present. However, the value is not a structurally valid JWT. In other words, one or more of the required elements of header, payload, and signature is missing.</p>

<p><em>Diagnostics - The JWT associated with the Authorisation header must have all 3 sections</em></p>

<!--
| HTTP Code | issue-severity | issue-type | Details.Code | Details.Display | Diagnostics |
|-----------|----------------|------------|--------------|-----------------|-------------------|
|400|error|<font color="red">structure</font> |MISSING_OR_INVALID_HEADER|There is a required header missing or invalid|The JWT associated with the Authorisation header must have the 3 sections|

Diagnostics - The JWT associated with the Authorisation header must have the 3 sections -->

<p>Example 3: Mandatory claim missing – the Authorization header is present and the JWT is structurally valid. However, one or more of the mandatory claims is missing from the JWT.</p>

<p><em>Diagnostics - The mandatory claim [claim] from the JWT associated with the Authorisation header is missing</em></p>

<!--
| HTTP Code | issue-severity | issue-type | Details.Code | Details.Display | Diagnostics |
|-----------|----------------|------------|--------------|-----------------|-------------------|
|400|error|<font color="red">structure</font> |MISSING_OR_INVALID_HEADER|There is a required header missing or invalid|The mandatory claim [claim] from the JWT associated with the Authorisation header is missing|

Diagnostics - The mandatory claim [claim] from the JWT associated with the Authorisation header is missing -->

<p>Example 4: Claim’s value is invalid — the Authorization header is present, the JWT is structurally valid, and a mandatory claim is present in the JWT, but its value is not valid. The following table shows the various checking that is applied to each claim in the JWT and the associated diagnostics message:</p>

<table>
  <thead>
    <tr>
      <th>Claim being validated</th>
      <th>Error scenario</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">sub</code></td>
      <td>No <code class="highlighter-rouge">requesting_user</code> has been supplied and the sub claims’ value does not match the value of the <code class="highlighter-rouge">requesting_system</code> claim.</td>
      <td><code class="highlighter-rouge">requesting_system</code> and <code class="highlighter-rouge">sub</code> claim’s values must match.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">sub</code></td>
      <td><code class="highlighter-rouge">requesting_user</code> has been supplied and the sub claims’ value does not match the value of the <code class="highlighter-rouge">requesting_user</code> claim.</td>
      <td><code class="highlighter-rouge">requesting_user</code> and <code class="highlighter-rouge">sub</code> claim’s values must match.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">reason_for_request</code></td>
      <td>Reason for request does not have the value “directcare”.</td>
      <td><code class="highlighter-rouge">reason_for_request</code> must be “directcare”.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">scope</code></td>
      <td>For requests to the NRL: scope is not one of <code class="highlighter-rouge">patient/DocumentReference.read</code> or <code class="highlighter-rouge">patient/DocumentReference.write</code>.</td>
      <td><code class="highlighter-rouge">scope</code> must match either <code class="highlighter-rouge">patient/DocumentReference.read</code> or <code class="highlighter-rouge">patient/DocumentReference.write</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">scope</code></td>
      <td>For requests to the SSP: scope is not <code class="highlighter-rouge">patient/*.read</code>.</td>
      <td><code class="highlighter-rouge">scope</code> must match <code class="highlighter-rouge">patient/*.read</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">requesting_system</code></td>
      <td>Requesting system is not of the form <code class="highlighter-rouge">https://fhir.nhs.uk/Id/accredited-system/[ASID]</code>.</td>
      <td><code class="highlighter-rouge">requesting_system</code> must be of the form <code class="highlighter-rouge">https://fhir.nhs.uk/Id/accredited-system/[ASID]</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">requesting_system</code></td>
      <td><code class="highlighter-rouge">requesting_system</code> is not an ASID that is known to Spine.</td>
      <td>The ASID must be known to Spine.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">requesting_organisation</code></td>
      <td><code class="highlighter-rouge">requesting_organisation</code> is not of the form <code class="highlighter-rouge">https://fhir.nhs.uk/Id/ods-organization-code/[ODSCode]</code>.</td>
      <td><code class="highlighter-rouge">requesting_organisation</code> must be of the form <code class="highlighter-rouge">https://fhir.nhs.uk/Id/ods-organization-code/[ODSCode]</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">requesting_organisation</code></td>
      <td>The ODS code of the <code class="highlighter-rouge">requesting_organisation</code> is not known to Spine.</td>
      <td>The ODS code of the <code class="highlighter-rouge">requesting_organisation</code> must be known to Spine.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">requesting_organisation</code></td>
      <td><code class="highlighter-rouge">requesting_organisation</code> is not associated with the ASID from the <code class="highlighter-rouge">requesting_system</code> claim.</td>
      <td>The <code class="highlighter-rouge">requesting_system</code> ASID must be associated with the <code class="highlighter-rouge">requesting_organisation</code> ODS code.</td>
    </tr>
  </tbody>
</table>

<p><strong>Precedence of <code class="highlighter-rouge">requesting_user</code> over <code class="highlighter-rouge">requesting_system</code></strong></p>

<p>If both the <code class="highlighter-rouge">requesting_system</code> and <code class="highlighter-rouge">requesting_user</code> claims have been provided, then the <code class="highlighter-rouge">sub</code> claim MUST match the <code class="highlighter-rouge">requesting_user</code> claim.</p>

<h4 id="provider-validation">Provider Validation</h4>

<p>No specific validation rules apply.</p>

<h4 id="consumer-validation">Consumer Validation</h4>

<p>In the context of a Consumer request, the <code class="highlighter-rouge">requesting_user</code> claim is mandatory for all NRL and SSP requests.</p>

<!--
Consumer systems MUST provided audit and provenance details in the HTTP authorization header as an oAuth bearer token (as outlined in [RFC 6749](https://tools.ietf.org/html/rfc6749){:target="_blank"}) in the form of a JSON Web Token (JWT) as defined in [RFC 7519](https://tools.ietf.org/html/rfc7519){:target="_blank"}.

An example such an HTTP header is given below:

```
     Authorization: Bearer jwt_token_string
```

In future, national authentication and authorisation services will be made available which will issue a bearer token which can be used directly for accessing this API. In the interrim however, the client will need to construct the JWT themselves.

It is highly recommended that standard libraries are used for creating the JWT as constructing and encoding the token manually may lead to issues with parsing the token in Spine. A good source of information about JWT and libraries to use can be found on the [JWT.io site](https://jwt.io/)

### JSON Web Tokens (JWT)

Consumer system MUST generate a new JWT for each API request. The Payload section of the JWT (see "JWT Generation" below for futher details) MUST be populated as follows:

| Claim | Priority | Description | Fixed Value | Dynamic Value | Specification / Example |
|-------|----------|-------------|-------------|---------------|-------------------------|
| iss | R | Client systems issuer URI | No | Yes | |
| sub | O | Identifier of individual making the request.| No | Yes | This field is conditionally mandatory. It must be supplied if the client is just a Consumer. However if the client is a Provider this field is optional. Note that if available the Provider should populate this field however in cases where no user is in scope then the sub can be left unpopulated. Where the sub is supplied it could be local system identifier for that user or if national Smartcard capability has been used then this will be the user’s UUID. |
| device | R | Identifier (ASID) of system where request originates | No | Yes | |
| aud | R | Requested resource URI | No | Yes | |
| exp | R | Expiration time integer after which this authorization MUST be considered invalid. | No | (now + 5 minutes) UTC time in seconds | |
| iat | R | The UTC time the JWT was created by the requesting system | `No| now UTC time in seconds | |
-->
<!--
<div markdown="span" class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> <b>Important:</b> In topologies where consumer applications are provisioned via a portal or middleware hosted by another organisation (e.g. a 'mini service' provider) it is important for audit purposes that the practitioner and organisation populated in the JWT reflect the originating organisation rather than the hosting organisation.</div>
-->
<!--
#### JWT Generation
Consumer systems MUST generate the JSON Web Token (JWT) consisting of three parts seperated by dots (.), which are:

- Header
- Payload
- Signature

The Spine does not currently validate the signature in the JWT that is sent, so the Consumer systems MAY generate an Unsecured JSON Web Token (JWT) using the "none" algorithm parameter in the header to indicate that no digital signature or MAC has been performed (please refer to section 6 of [RFC 7519](https://tools.ietf.org/html/rfc7519){:target="_blank"} for details).

```json
{
  "alg": "none",
  "typ": "JWT"
}
```

If using unsigned tokens, the consumer systems MUST generate an empty signature.

The final output is three base64url encoded strings separated by dots (note - there is some canonicalisation done to the JSON before it is base64url encoded, which the JWT code libraries will do for you).

For example:

```shell
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJpc3MiOiJodHRwOi8vZWMyLTU0LTE5NC0xMDktMTg0LmV1LXdlc3QtMS5jb21wdXRlLmFtYXpvbmF3cy5jb20vIy9zZWFyY2giLCJzdWIiOiIxIiwiYXVkIjoiaHR0cHM6Ly9hdXRob3JpemUuZmhpci5uaHMubmV0L3Rva2VuIiwiZXhwIjoxNDgxMjUyMjc1LCJpYXQiOjE0ODA5NTIyNzUsInJlYXNvbl9mb3JfcmVxdWVzdCI6ImRpcmVjdGNhcmUiLCJyZXF1ZXN0ZWRfcmVjb3JkIjp7InJlc291cmNlVHlwZSI6IlBhdGllbnQiLCJpZGVudGlmaWVyIjpbeyJzeXN0ZW0iOiJodHRwOi8vZmhpci5uaHMubmV0L0lkL25ocy1udW1iZXIiLCJ2YWx1ZSI6IjkwMDAwMDAwMzMifV19LCJyZXF1ZXN0ZWRfc2NvcGUiOiJwYXRpZW50LyoucmVhZCIsInJlcXVlc3RpbmdfZGV2aWNlIjp7InJlc291cmNlVHlwZSI6IkRldmljZSIsImlkIjoiMSIsImlkZW50aWZpZXIiOlt7InN5c3RlbSI6IldlYiBJbnRlcmZhY2UiLCJ2YWx1ZSI6IkdQIENvbm5lY3QgRGVtb25zdHJhdG9yIn1dLCJtb2RlbCI6IkRlbW9uc3RyYXRvciIsInZlcnNpb24iOiIxLjAifSwicmVxdWVzdGluZ19vcmdhbml6YXRpb24iOnsicmVzb3VyY2VUeXBlIjoiT3JnYW5pemF0aW9uIiwiaWQiOiIxIiwiaWRlbnRpZmllciI6W3sic3lzdGVtIjoiaHR0cDovL2ZoaXIubmhzLm5ldC9JZC9vZHMtb3JnYW5pemF0aW9uLWNvZGUiLCJ2YWx1ZSI6IltPRFNDb2RlXSJ9XSwibmFtZSI6IkdQIENvbm5lY3QgRGVtb25zdHJhdG9yIn0sInJlcXVlc3RpbmdfcHJhY3RpdGlvbmVyIjp7InJlc291cmNlVHlwZSI6IlByYWN0aXRpb25lciIsImlkIjoiMSIsImlkZW50aWZpZXIiOlt7InN5c3RlbSI6Imh0dHA6Ly9maGlyLm5ocy5uZXQvc2RzLXVzZXItaWQiLCJ2YWx1ZSI6IkcxMzU3OTEzNSJ9LHsic3lzdGVtIjoibG9jYWxTeXN0ZW0iLCJ2YWx1ZSI6IjEifV0sIm5hbWUiOnsiZmFtaWx5IjpbIkRlbW9uc3RyYXRvciJdLCJnaXZlbiI6WyJHUENvbm5lY3QiXSwicHJlZml4IjpbIk1yIl19fX0.
```

NOTE: As this is an unsigned token, the final section (the signature) is empty, so the JWT will end with a trailing . - this must not be omitted as it will then not be a valid token.

<div markdown="span" class="alert alert-success" role="alert"><i class="fa fa-check-square-o"></i> <b>Tip:</b> The [JWT.io](https://jwt.io/) website includes a number of rich resources to aid in developing JWT enabled applications.</div>

## Audit Trail

The various parts of an audit trail will be assembled from different parts of the request and in some cases will be calculated properties

### Request Audit Trail
_"This [local user on this] (1) system (2) from this organisation (3) with this legitimate relationship (4) has sent this request (5) at this time (6)..."_

1.  local user - taken from the sub claim on the JWT which is sent under the mandatory Authorization HTTP header. Note that the sub claim may or may not be provided (see [JWT](integration_cross_organisation_audit_and_provenance.html#json-web-tokens-jwt) table above)
2.  system - the ASID of the client system. Taken from the device claim on the [JWT](integration_cross_organisation_audit_and_provenance.html#json-web-tokens-jwt) which is sent under the mandatory Authorization HTTP header.
3.  organisation - calculated by looking up the ODS code of the Organisation that is associated with the ASID (Ssp-From)
4.  legitimate relationship - currently expected to be a fixed value of "directcare". No validation will be performed as to whether the given system and or organisation
are valid in their use of direct care as the kind of relationship
5.  request- the request URL, HTTP verb and the body of the request (in the case of a Provider's create and update actions)
6.  time - the datetime that the request landed on the NRL web server

### Response Audit Trail
_"...which resulted in this response (1) at this time (2)"_

1.  response - HTTP response code, response body (if present), Location header (for create and update)
2.  time - the datetime that the NRL web server posted its response to the client

For more detail on the Audit capabilities of the NRL see [Auditing](overview_behaviours.html#auditing)
-->


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="tags.html?tags=integration" class="btn btn-default navbar-btn cursorNorm" role="button">integration</a>
        
        
        
        <a href="tags.html?tags=security" class="btn btn-default navbar-btn cursorNorm" role="button">security</a>
        
        
        
        <a href="tags.html?tags=authorisation" class="btn btn-default navbar-btn cursorNorm" role="button">authorisation</a>
        
        
        
        <a href="tags.html?tags=spine_secure_proxy" class="btn btn-default navbar-btn cursorNorm" role="button">spine secure proxy</a>
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    <img class="pull-left" src="images/explanatoryline.png" alt="NHS Digital Explanatory Line"/>
                    <br/>
                    &copy;2020 NHS Digital<br />
                     Site last generated: Mar 30, 2020 <br />
                    6f68aaa672cc33d7cfbcf7b81b91ebc455b910a9<br/>
                    <br/>
                    <!-- OGL Licence -->
                    <div class="open-government-licence">
                        <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon"><img src="images/licence/ogl-symbol-41px-retina-black.png"></img></a>
                        <p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon">Open Government Licence v3.0</a>, except where otherwise stated</p>
                    </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99659472-1', 'auto');
  ga('send', 'pageview');

</script>

 


</body>

</html>
