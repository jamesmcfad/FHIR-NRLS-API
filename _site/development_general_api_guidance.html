<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Implementation guidance for developers - focusing on general API implementation guidance">
<meta name="keywords" content="fhirdevelopmentfor_providersfor_consumers,  fhir development">
<title>General API guidance | NRL</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="FHIR-NRLS-API" href="https://developer.nhs.uk/apis/nrl/feed.xml">





    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> NRL API | FHIR&reg;</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="Search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="General API guidance">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                








<ul id="mysidebar" class="nav">

    <!-- <p style="font-size:2em;">-->

       <!-- <img src="images/interopen.png" height="48px" alt="INTEROpen Logo"/>
    INTEROPen</p>
    <p style="font-size:16px;">Supported by -->
    <img src="images/logo.png"   alt="NHS Digital Logo"/>
    <!--</p>-->


    <li class="sidebarTitle">NRL 2.3.0-beta API <i>specification</i></li>
    
    
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="overview_guide_versioning.html">Product Versioning</a></li>
            
            
            
            
            
            
            <li><a href="overview_release_notes.html">Release Notes</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Solution</a>
        <ul>
            
            
            
            <li><a href="overview_concepts.html">Concepts</a></li>
            
            
            
            
            
            
            <li><a href="overview_behaviours.html">Behaviour</a></li>
            
            
            
            
            
            
            <li><a href="overview_principles.html">Principles</a></li>
            
            
            
            
            
            
            <li><a href="overview_data_model.html">Data model</a></li>
            
            
            
            
            
            
            <li><a href="overview_interactions.html">Interactions</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">General Guidance</a>
        <ul>
            
            
            
            <li><a href="pointer_identity.html">Pointer Identity</a></li>
            
            
            
            
            
            
            <li><a href="pointer_errors.html">Pointer Errors</a></li>
            
            
            
            
            
            
            <li><a href="pointer_lifecycle.html">Pointer Lifecycle</a></li>
            
            
            
            
            
            
            <li><a href="pointer_maintenance.html">Pointer Maintenance</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Development Guidance</a>
        <ul>
            
            
            
            <li><a href="explore.html">Overview</a></li>
            
            
            
            
            
            
            <li class="active"><a href="development_general_api_guidance.html">General API Guidance</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">DocumentReference API Interactions</a>
                <ul>
                    
                    
                    
                    <li><a href="api_interaction_create.html">Create</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_supersede.html">Create (Supersede)</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_update.html">Update</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_delete.html">Delete</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_read.html">Read</a></li>
                    
                    
                    
                    
                    
                    <li><a href="api_interaction_search.html">Search</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Record Retrieval Guidance</a>
                <ul>
                    
                    
                    
                    <li><a href="retrieval_overview.html">Overview</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_interaction_read.html">Read Interaction</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_consumer_guidance.html">Consumer Guidance</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_provider_guidance.html">Provider Guidance</a></li>
                    
                    
                    
                    
                    
                    <li><a href="retrieval_formats.html">Formats</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
            
            
            <li><a href="explore_reference.html">FHIR Profile Reference</a></li>
            
            
            
            
            
            
            <li><a href="explore_fhir_open_source_guidance.html">FHIR Open-Source Resources</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Integrate With Spine</a>
        <ul>
            
            
            
            <li><a href="integration_authentication_authorisation.html">Authentication &amp; Authorisation</a></li>
            
            
            
            
            
            
            <li><a href="explore_rbac_mapping.html">Access Control</a></li>
            
            
            
            
            
            
            <li><a href="development_api_security_guidance.html">Security</a></li>
            
            
            
            
            
            
            <li><a href="integration_access_tokens_JWT.html">Access Tokens (JWT)</a></li>
            
            
            
            
            
            
            <li><a href="integration_auditing.html">Auditing</a></li>
            
            
            
            
            
            
            <li><a href="integration_personal_demographics_service.html">Personal Demographics Service</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
        
            <li><a href="/assure.html">Assure</a></li>
        
    
        
    
    <li>
        <a href="#">Help &amp; Support</a>
        <ul>
            
            
            
            <li><a href="support_faq.html">Frequently Asked Questions (FAQ)</a></li>
            
            
            
            
            
            
            <li><a href="support_communications.html">Communication Channels</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
        
            <li><a href="/tags.html">Tags</a></li>
        
    
        
    
        
            <li><a href="/overview_glossary.html">Glossary</a></li>
        
    
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    <!--</li>-->
</ul>
<!--</div>-->

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-header">
   <h1 class="post-title-main">General API guidance</h1>
</div>

<script>
    $(function() {
        $('a[href^="http://"], a[href^="https://"]')
            .attr('target', '_blank') // open all external links in new tab
            .attr('rel', 'noopener noreferrer'); // https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/
    });
</script>



<div class="post-content">

   
    <div class="summary">Implementation guidance for developers - focusing on general API implementation guidance</div>
   

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.
<!-- removed h3 and h4 from toc KGM 10/JULY/2017 -->
$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

  <div markdown="span" class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> <b>Important:</b> This site is under active development by NHS Digital and is intended to provide all the technical resources you need to successfully develop with the National Record Locator API. This project is being developed using an agile methodology, so iterative updates to content will be added on a regular basis.</div>

  <h2 id="purpose">Purpose</h2>

<p>This implementation guide is intended for use by software developers looking to build a conformant NRL API interface using the FHIR® standard, with a focus on general API implementation guidance.</p>

<h3 id="notational-conventions">Notational Conventions</h3>

<p>The keywords ‘<strong>MUST</strong>’, ‘<strong>MUST NOT</strong>’, ‘<strong>REQUIRED</strong>’, ‘<strong>SHALL</strong>’, ‘<strong>SHALL NOT</strong>’, ‘<strong>SHOULD</strong>’, ‘<strong>SHOULD NOT</strong>’, ‘<strong>RECOMMENDED</strong>’, ‘<strong>MAY</strong>’, and ‘<strong>OPTIONAL</strong>’ in this implementation guide are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>.</p>

<h2 id="restful-api">RESTful API</h2>

<h3 id="content-types">Content Types</h3>

<ul>
  <li>The NRL Server MUST support both formal <a href="https://www.hl7.org/fhir/STU3/http.html#mime-type">MIME-types</a> for FHIR resources:
    <ul>
      <li>XML: <code class="highlighter-rouge">application/fhir+xml</code></li>
      <li>JSON: <code class="highlighter-rouge">application/fhir+json</code></li>
    </ul>
  </li>
  <li>The NRL Server MUST also support DSTU2 <a href="https://www.hl7.org/fhir/DSTU2/http.html#mime-type">MIME-types</a> for backwards compatibility:
    <ul>
      <li>XML: <code class="highlighter-rouge">application/xml+fhir</code></li>
      <li>JSON: <code class="highlighter-rouge">application/json+fhir</code></li>
    </ul>
  </li>
  <li>The NRL Server MUST also gracefully handle generic XML and JSON MIME types:
    <ul>
      <li>XML: <code class="highlighter-rouge">application/xml</code></li>
      <li>JSON: <code class="highlighter-rouge">application/json</code></li>
      <li>JSON: <code class="highlighter-rouge">text/json</code></li>
    </ul>
  </li>
  <li>
    <p>The NRL Server MUST support the optional <code class="highlighter-rouge">_format</code> parameter in order to allow the client to specify the response format by its MIME type. If both are present, the <code class="highlighter-rouge">_format</code> parameter overrides the <code class="highlighter-rouge">Accept</code> header value in the request.</p>
  </li>
  <li>If neither the <code class="highlighter-rouge">Accept</code> header nor the <code class="highlighter-rouge">_format</code> parameter are supplied by the client system, the NRL Server MUST return data in the default format of <code class="highlighter-rouge">application/fhir+xml</code>.</li>
</ul>

<h2 id="error-handling">Error Handling</h2>

<p>The NRL API defines many categories of errors, each of which encapsulates a specific part of the request sent to the NRL. Each type of error is discussed in its own section below with the relevant Spine response code:</p>
<ul>
  <li><a href="development_general_api_guidance.html#resource-not-found">Resource not found</a> — Spine supports this behaviour when:
    <ul>
      <li>A request references a resource, such as a DocumentReference or Patient, that cannot be resolved.</li>
      <li>A request supports an NHS Number where no Spine Clinicals record exists for that NHS Number.</li>
    </ul>
  </li>
  <li><a href="development_general_api_guidance.html#headers">Headers</a> — There are a number of HTTP headers that must be supplied with any request. In addition, values associated with those headers have their own validation rules.</li>
  <li><a href="development_general_api_guidance.html#parameters">Parameters</a> – Certain actions against the NRL allow a client to specify HTTP parameters. This class of error covers problems with the way those parameters are presented.</li>
  <li><a href="development_general_api_guidance.html#payload-business-rules">Payload business rules</a> — Errors of this nature will arise when the request payload (DocumentReference) does not conform to the business rules associated with its use as an NRL Pointer.</li>
  <li><a href="development_general_api_guidance.html#payload-syntax">Payload syntax</a> — Used to inform the client that the syntax of the request payload (DocumentReference) is invalid. For example, if using JSON to carry the DocumentReference, the structure of the payload may not conform to JSON notation.</li>
  <li><a href="development_general_api_guidance.html#organisation-not-found">Organisation not found</a> — Used to inform the client that the URL being used to reference a given Organisation is invalid.</li>
  <li><a href="development_general_api_guidance.html#invalid-nhs-number">Invalid NHS Number</a> — Used to inform a client that  NHS Number used in a Provider pointer create or Consumer search interaction is invalid.</li>
  <li><a href="development_general_api_guidance.html#unsupported-media-type">Unsupported Media Type</a> — Used to inform the client that requested content types are not supported by the NRL service.</li>
  <li><a href="development_general_api_guidance.html#access-denied">Access denied</a> — Used to inform the client that access to perform the interaction has been denied.</li>
  <li><a href="development_general_api_guidance.html#internal-error">Internal error</a> — Used to inform the client if there is a failure during the change of the DocumentReference status.</li>
</ul>

<p>The error codes (including other Spine error codes that are outside the scope of this API) are defined in the <a href="https://fhir.nhs.uk/STU3/ValueSet/Spine-ErrorOrWarningCode-1">Spine Error or Warning Code ValueSet</a>.</p>

<h3 id="resource-not-found">Resource Not Found</h3>

<p>There are two situations when Spine supports this behaviour:</p>

<ul>
  <li>When a request references a resource that cannot be resolved. For example, this error should be expected when a request references the <a href="explore_reference.html#2-nrl-data-model-to-fhir-profile-mapping">unique ID</a> of a DocumentReference, but the ID is not known to the NRL. There are three scenarios in which the NRL Service supports this exception:
    <ul>
      <li>Provider client retrieval of a DocumentReference by logical identifier</li>
      <li>Provider client request to delete a DocumentReference by logical identifier or master identifier</li>
      <li>Provider client request to update a DocumentReference by logical identifier or master identifier</li>
    </ul>
  </li>
  <li>When a request specifies an NHS Number for which no corresponding Clinicals record exists in the Spine Clinicals data store. The NRL Service supports this exception scenario in the consumer and Provider Search API interface.</li>
</ul>

<p>The following table summarises the HTTP response codes, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for these exception scenarios.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>404</td>
      <td>error</td>
      <td>not-found</td>
      <td>NO_RECORD_FOUND</td>
      <td>No record found</td>
      <td>No record found for supplied DocumentReference identifier - [id]</td>
    </tr>
    <tr>
      <td>404</td>
      <td>error</td>
      <td>not-found</td>
      <td>NO_RECORD_FOUND</td>
      <td>No record found</td>
      <td>The given NHS number could not be found [nhsNumber]</td>
    </tr>
  </tbody>
</table>

<h3 id="headers">Headers</h3>

<p>This error will be thrown in relation to the mandatory HTTP request headers. Scenarios where this error might be thrown:</p>
<ul>
  <li>
    <p>The  mandatory <code class="highlighter-rouge">fromASID</code> HTTP Header is missing in the request.</p>

    <p>The table details the HTTP response code, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this scenario. Note that the header name is case-sensitive.</p>

    <table>
      <thead>
        <tr>
          <th>HTTP Code</th>
          <th>issue-severity</th>
          <th>issue-type</th>
          <th>Details.Code</th>
          <th>Details.Display</th>
          <th>Diagnostics</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>400</td>
          <td>error</td>
          <td>invalid</td>
          <td>MISSING_OR_INVALID_HEADER</td>
          <td>There is a required header missing or invalid</td>
          <td>fromASID HTTP Header is missing</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>The mandatory <code class="highlighter-rouge">toASID</code> HTTP Header is missing in the request</p>

    <p>The table details the HTTP response code, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this scenario.</p>

    <table>
      <thead>
        <tr>
          <th>HTTP Code</th>
          <th>issue-severity</th>
          <th>issue-type</th>
          <th>Details.Code</th>
          <th>Details.Display</th>
          <th>Diagnostics</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>400</td>
          <td>error</td>
          <td>invalid</td>
          <td>MISSING_OR_INVALID_HEADER</td>
          <td>There is a required header missing or invalid</td>
          <td>toASID HTTP Header is missing</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>The mandatory <code class="highlighter-rouge">Authorization</code> HTTP Header is missing in the request</p>

    <p>The table details the HTTP response code, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this scenario.</p>

    <table>
      <thead>
        <tr>
          <th>HTTP Code</th>
          <th>issue-severity</th>
          <th>issue-type</th>
          <th>Details.Code</th>
          <th>Details.Display</th>
          <th>Diagnostics</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>400</td>
          <td>error</td>
          <td>invalid</td>
          <td>MISSING_OR_INVALID_HEADER</td>
          <td>There is a required header missing or invalid</td>
          <td>Authorization HTTP Header is missing</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<h3 id="parameters">Parameters</h3>

<p>This error will be raised in relation to request parameters that the client may have specified. This error can be raised in a variety of circumstances.</p>

<p>The following table summarises the HTTP response codes, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this exception scenario.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>invlid</td>
      <td>INVALID_PARAMETER</td>
      <td>Invalid parameter</td>
    </tr>
  </tbody>
</table>

<h4 id="subject-parameter">Subject Parameter</h4>

<p>When using the REQUIRED <code class="highlighter-rouge">subject</code> parameter, the client is referring to a Patient FHIR resource by reference. Two pieces of information are needed:</p>
<ul>
  <li>
    <p>The URL of the FHIR server that hosts the Patient resource.  If the URL of the server is not <code class="highlighter-rouge">https://demographics.spineservices.nhs.uk/STU3/Patient/</code>, this error will be thrown.</p>
  </li>
  <li>
    <p>An identifier for the Patient resource being referenced. The identifier must be known to the server. In addition, where NHS Digital owns the business identifier scheme for a given type of FHIR resource, the logical and business identifiers will be the same. In this case, the NHS number of a Patient resource is both a logical and business identifier, meaning that it can be specified without the need to supply the identifier scheme. If the NHS number is missing from the patient parameter, this error will be thrown.</p>
  </li>
</ul>

<h4 id="custodian-parameter">Custodian Parameter</h4>

<p>When using the OPTIONAL <code class="highlighter-rouge">custodian</code> parameter, the client is referring to an Organisation by a business identifier, specifically its ODS code. Two pieces of information are needed:</p>
<ul>
  <li>The business identifier scheme. In this case, it must be <code class="highlighter-rouge">https://fhir.nhs.uk/Id/ods-organization-code</code>.</li>
  <li>The business identifier. The identifier must meet the following requirements:
    <ul>
      <li>It must be a valid ODS code.</li>
      <li>The ODS code must be an organisation that is known to the NRL.</li>
      <li>The ODS code must be in the Provider role.</li>
    </ul>
  </li>
</ul>

<h4 id="_format-request-parameter"><code class="highlighter-rouge">_format</code> Request Parameter</h4>

<p>This parameter must specify one of the <a href="development_general_api_guidance.html#restful-api">mime types</a> recognised by the NRL.</p>

<h4 id="invalid-reference-url-in-pointer-create-request">Invalid Reference URL in Pointer Create Request</h4>

<p>This error is raised during a provider create interaction. There are two exception scenarios:</p>
<ul>
  <li>The DocumentReference in the request body specifies an incorrect URL for the FHIR server that hosts the Patient resource.</li>
  <li>The DocumentReference in the request body specifies an incorrect URL for the author and custodian Organization resource.</li>
</ul>

<h4 id="type-parameter"><code class="highlighter-rouge">type</code> Parameter</h4>

<p>When using the REQUIRED <code class="highlighter-rouge">type</code> parameter, the client is referring to a pointer by record type. Two pieces of information are needed:</p>
<ul>
  <li>The identity of the <a href="http://snomed.info/sct">SNOMED URI</a> terminology system</li>
  <li>The pointer record type SNOMED concept, such as 736253002</li>
</ul>

<p>If the search request specifies unsupported parameter values in the request, this error will be thrown.</p>

<h4 id="masteridentifier-parameter"><code class="highlighter-rouge">masterIdentifier</code> Parameter</h4>

<p>Where masterIdentifier is a search term, both the system and value parameters must be supplied.</p>

<h4 id="_summary-parameter"><code class="highlighter-rouge">_summary</code> Parameter</h4>

<p>The _summary parameter must have a value of “count”. If it is anything else, an error should be returned to the client.</p>

<p>If the _summary parameter is provided then the only other parameter that it can be used with is the optional _format param. If any other parameters are provided, an error should be returned to the client.</p>

<h3 id="payload-business-rules">Payload Business Rules</h3>

<h4 id="invalid-resource">Invalid Resource</h4>

<p>This error code may surface when creating or deleting a DocumentReference. There are a number of properties that make up the DocumentReference which have business rules associated with them. If there are problems with one or more of these properties, this error may be thrown.</p>

<p>This error code may also surface when updating a DocumentReference using the Parameters resource and Update interaction. This error may be thrown if the resource does not include the specified parameters or does not conform to the associated business rules.</p>

<p>The following table summarises the HTTP response code, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this exception scenario.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>invalid</td>
      <td>INVALID_RESOURCE</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> Although not stated in the table above, the OperationOutcome that the NRL returns in these scenarios will include <code class="highlighter-rouge">Details.display</code> and <code class="highlighter-rouge">Diagnostics</code> detail, which will aid in identifying which property this issue relates to.</div>

<h4 id="create-and-supersede-invalid-resource-errors">Create and Supersede Invalid Resource Errors</h4>

<p>The following scenarios relate to the <a href="api_interaction_create.html">create</a> and <a href="api_interaction_supersede.html">supersede</a> interactions (HTTP POST):</p>

<ul>
  <li>
    <p><strong>Mandatory fields</strong></p>

    <p>If one or more mandatory fields are missing, this error will be thrown. See <a href="explore_reference.html#2-nrl-data-model-to-fhir-profile-mapping">DocumentReference</a> profile.</p>
  </li>
  <li>
    <p><strong>Mandatory field values</strong></p>

    <p>If one or more mandatory fields are missing values, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Custodian</strong></p>

    <p>If the DocumentReference in the request body contains an ODS code on the custodian element that is not tied to the ASID supplied in the HTTP request header fromASID, this error will result.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Content.Attachment.Creation</strong></p>

    <p>If this optional field is supplied, it must be a valid <a href="https://www.hl7.org/fhir/STU3/datatypes.html#dateTime">FHIR dateTime</a></p>
  </li>
  <li>
    <p><strong>DocumentReference.Status</strong></p>

    <p>If the DocumentReference in the request body specifies a status code that is not supported by the required HL7 FHIR <a href="http://hl7.org/fhir/ValueSet/document-reference-status">document-reference-status</a> valueset, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Type</strong></p>

    <p>If the DocumentReference in the request body specifies a type that is not part of the valueset defined in the <a href="https://fhir.nhs.uk/STU3/StructureDefinition/NRL-DocumentReference-1">NRL-DocumentReference-1</a> FHIR profile, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Indexed</strong></p>

    <p>If the DocumentReference in the request body specifies an indexed element that is not a valid <a href="http://hl7.org/fhir/STU3/datatypes.html#instant">FHIR instant</a>, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Class</strong></p>

    <p>If the DocumentReference in the request body specifies a class that is not part of the valueset defined in the <a href="https://fhir.nhs.uk/STU3/StructureDefinition/NRL-DocumentReference-1">NRL-DocumentReference-1 FHIR profile</a>, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Content.Format</strong></p>

    <p>If the DocumentReference in the request body specifies a format that is not part of the valueset defined in the <a href="https://fhir.nhs.uk/STU3/StructureDefinition/NRL-DocumentReference-1">NRL-DocumentReference-1 FHIR profile</a>, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Content.Extension:RetrievalMode</strong></p>

    <p>If the DocumentReference in the request body specifies a retrievalMode that is not part of the valueset defined in the <a href="https://fhir.nhs.uk/STU3/StructureDefinition/NRL-DocumentReference-1">NRL-DocumentReference-1 FHIR profile</a>, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Context.PracticeSetting</strong></p>

    <p>If the DocumentReference in the request body specifies a practiceSetting that is not part of the valueset defined in the <a href="https://fhir.nhs.uk/STU3/StructureDefinition/NRL-DocumentReference-1">NRL-DocumentReference-1 FHIR profile</a>, this error will be thrown.</p>
  </li>
  <li>
    <p><strong>DocumentReference.Context.Period</strong></p>

    <p>If the DocumentReference in the request body specifies a period:</p>
    <ul>
      <li>At least the start date must be populated and must be a valid <a href="https://www.hl7.org/fhir/STU3/datatypes.html#dateTime">FHIR dateTime</a>.</li>
      <li>If the end date is populated it must be a valid <a href="https://www.hl7.org/fhir/STU3/datatypes.html#dateTime">FHIR dateTime</a>.</li>
    </ul>
  </li>
  <li>
    <p><strong>DocumentReference.RelatesTo</strong></p>

    <p>If multiple relatesTo elements are included in a create request, an error will be returned.</p>
  </li>
  <li>
    <p><strong>DocumentReference.RelatesTo.Code</strong></p>

    <p>If the code is not set to the value “replaces”, an error will be returned.</p>
  </li>
  <li>
    <p><strong>Incorrect permissions to modify</strong></p>

    <p>When the NRL resolves a DocumentReference through the relatesTo property before modifying its status, the NRL should check that the ODS code associated with the fromASID HTTP header is associated with the ODS code specified on the custodian property of the DocumentReference. If not, the NRL should roll back all changes and return an error.</p>
  </li>
  <li>
    <p><strong>Patient mismatch</strong></p>

    <p>When the NRL resolves a DocumentReference through the relatesTo property, the subject property reference value must match the subject property reference on the new DocumentReference being created. If not, the NRL should roll back all changes and return an error.</p>
  </li>
  <li>
    <p><strong>MasterIdentifier mismatch</strong></p>

    <p>When the NRL resolves a DocumentReference through the relatesTo property and both the <code class="highlighter-rouge">relatesTo.target.identifier</code> and <code class="highlighter-rouge">relatesTo.target.reference</code> properties are populated, the <code class="highlighter-rouge">relatesTo.target.identifier</code> value must match the masterIdentifier property on the resolved DocumentReference. If not, the NRL should roll back all changes and return an error.</p>
  </li>
  <li>
    <p><strong>DocumentReference does not exist</strong></p>

    <p>If the NRL fails to resolve a DocumentReference through the relatesTo property, the NRL should roll back all changes and return an error.</p>
  </li>
</ul>

<h4 id="update-invalid-resource-errors">Update Invalid Resource Errors</h4>

<p>The following scenarios relate to the <a href="api_interaction_update.html">Update</a> interaction (HTTP PATCH):</p>

<ul>
  <li>
    <p><strong>Parameters: Type</strong></p>

    <p>When updating a DocumentReference, if the type parameter in the Parameters resource in the request body does not have the value “replace”, an error will be returned.</p>
  </li>
  <li>
    <p><strong>Parameters: Path</strong></p>

    <p>When updating a DocumentReference, if the path parameter in the Parameters resource in the request body does not have the value “DocumentReference.status”, an error will be returned.</p>
  </li>
  <li>
    <p><strong>Parameters: Value</strong></p>

    <p>When updating a DocumentReference, if the value parameter in the Parameters resource in the request body does not have the value “entered-in-error”, an error will be returned.</p>
  </li>
  <li>
    <p><strong>Provider ODS Code does not match Custodian ODS Code</strong></p>

    <p>If a provider update pointer request contains a URL that resolves to a single DocumentReference, but the custodian property does not match the ODS code associated to the ASID value in the fromASID header, an error will be returned.</p>
  </li>
</ul>

<h4 id="delete-invalid-resource-errors">Delete Invalid Resource Errors</h4>

<p>The following scenarios relate to the <a href="api_interaction_delete.html">Delete</a> interaction (HTTP DELETE):</p>

<ul>
  <li>
    <p><strong>Provider ODS Code does not match Custodian ODS Code</strong></p>

    <p>If a provider delete pointer request contains a URL that resolves to a single DocumentReference, but the custodian property does not match the ODS code associated to the ASID value in the fromASID header, an error will be returned.</p>
  </li>
</ul>

<h4 id="duplicate-resource">Duplicate Resource</h4>

<p>When the NRL persists a DocumentReference with a masterIdentifier, it should ensure that no other DocumentReference exists 
for that patient with the same masterIdentifier.</p>

<p>The following table summarises the HTTP response code, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this exception scenario.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>duplicate</td>
      <td>DUPLICATE_REJECTED</td>
      <td>Duplicate DocumentReference</td>
      <td>Duplicate masterIdentifier value: [masterIdentifier.value]<br />system: [masterIdentifier.system]</td>
    </tr>
  </tbody>
</table>

<h4 id="inactive-documentreference">Inactive DocumentReference</h4>

<p>This error is raised when the status of the DocumentReference to be retrieved or modified is not “current”.</p>

<p>The following table summarises the HTTP response code, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this exception scenario.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>warning</td>
      <td>invalid</td>
      <td>BAD_REQUEST</td>
      <td>Bad Request</td>
      <td>DocumentReference status is not “current”</td>
    </tr>
  </tbody>
</table>

<h3 id="payload-syntax">Payload Syntax</h3>

<h4 id="invalid-request-message">Invalid Request Message</h4>

<p>The INVALID_REQUEST_MESSAGE error is triggered when there is an XML or JSON syntax error in the DocumentReference resource in the request payload.</p>

<p>It is distinct from the INVALID_RESOURCE error, which conveys problems relating to the business rules associated with an NRL DocumentReference.</p>

<p>The following table summarises the HTTP response codes, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this exception scenario.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>value</td>
      <td>INVALID_REQUEST_MESSAGE</td>
      <td>Invalid Request Message</td>
      <td>Invalid Request Message</td>
    </tr>
  </tbody>
</table>

<h3 id="organisation-not-found">Organisation Not Found</h3>

<p>Organisations referenced in a DocumentReference must point to a resolvable FHIR Organisation resource. If the URL being used to reference a given Organisation is invalid, this error will result.</p>

<p>The URL must have the format <code class="highlighter-rouge">https://directory.spineservices.nhs.uk/STU3/Organization/[odsCode]</code>, where <code class="highlighter-rouge">[odsCode]</code>:</p>
<ul>
  <li>Is a valid ODS code.</li>
  <li>Refers to an organisation known to the NRL.</li>
  <li>The ODS code associated with the custodian property must be in the Provider role.</li>
</ul>

<p>If an exception occurs, it should be displayed following the rules, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> shown in the following table.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>not-found</td>
      <td>ORGANISATION_NOT_FOUND</td>
      <td>Organisation record not found</td>
      <td>The ODS code in the custodian and/or author element is not resolvable - [ods code].</td>
    </tr>
  </tbody>
</table>

<h3 id="invalid-nhs-number">Invalid NHS Number</h3>
<p>Used to inform a client that  NHS Number used in a provider pointer create or consumer search interaction is invalid.</p>

<p>The following table summarises the HTTP response codes, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for this exception scenario.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>400</td>
      <td>error</td>
      <td>invalid</td>
      <td>INVALID_NHS_NUMBER</td>
      <td>Invalid NHS number</td>
      <td>The NHS number does not conform to the NHS Number format: [nhs number].</td>
    </tr>
  </tbody>
</table>

<h3 id="unsupported-media-type">Unsupported Media Type</h3>

<p>There are three scenarios when an Unsupported Media Type business response code MUST be returned to a client:</p>
<ul>
  <li>Request contains an unsupported <code class="highlighter-rouge">Accept</code> header and an unsupported <code class="highlighter-rouge">_format</code> parameter.</li>
  <li>Request contains a supported <code class="highlighter-rouge">Accept</code> header and an unsupported <code class="highlighter-rouge">_format</code> parameter.</li>
  <li>Retrieval search query request parameters are valid, but the URL contains an unsupported <code class="highlighter-rouge">_format</code> parameter value.</li>
</ul>

<p>These exceptions are raised by the Spine Core common requesthandler and not the NRL Service. They are supported by the default Spine OperationOutcome <a href="https://fhir.nhs.uk/StructureDefinition/spine-operationoutcome-1-0">spine-operationoutcome-1-0</a> profile, which binds to the default Spine ValueSet <a href="https://fhir.nhs.uk/ValueSet/spine-response-code-1-0">spine-response-code-1-0</a>. The following table summarises the HTTP response codes, along with the values to expect in the <code class="highlighter-rouge">OperationOutcome</code> in the response body for these exception scenarios.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Code</th>
      <th>issue-severity</th>
      <th>issue-type</th>
      <th>Details.System</th>
      <th>Details.Code</th>
      <th>Details.Display</th>
      <th>Diagnostics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>415</td>
      <td>error</td>
      <td>invalid</td>
      <td>http://fhir.nhs.net/ValueSet/spine-response-code-1-0</td>
      <td>UNSUPPORTED_MEDIA_TYPE</td>
      <td>Unsupported Media Type</td>
      <td>Unsupported Media Type</td>
    </tr>
  </tbody>
</table>

<h3 id="internal-error">Internal Error</h3>

<p>Where the request cannot be processed, but the fault is with the NRL service and not the client, the NRL service will return a 500 HTTP response code, along with a descriptive message in the response body, such as:</p>

<p><code class="highlighter-rouge"><span class="nt">&lt;html&gt;&lt;title&gt;</span>500: Internal Server Error<span class="nt">&lt;/title&gt;&lt;body&gt;</span>500: Internal Server Error<span class="nt">&lt;/body&gt;&lt;/html&gt;</span></code></p>


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="tags.html?tags=fhir" class="btn btn-default navbar-btn cursorNorm" role="button">fhir</a>
        
        
        
        <a href="tags.html?tags=development" class="btn btn-default navbar-btn cursorNorm" role="button">development</a>
        
        
        
        <a href="tags.html?tags=for_providers" class="btn btn-default navbar-btn cursorNorm" role="button">for providers</a>
        
        
        
        <a href="tags.html?tags=for_consumers" class="btn btn-default navbar-btn cursorNorm" role="button">for consumers</a>
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    <img class="pull-left" src="images/explanatoryline.png" alt="NHS Digital Explanatory Line"/>
                    <br/>
                    &copy;2020 NHS Digital<br />
                     Site last generated: Mar 30, 2020 <br />
                    6f68aaa672cc33d7cfbcf7b81b91ebc455b910a9<br/>
                    <br/>
                    <!-- OGL Licence -->
                    <div class="open-government-licence">
                        <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon"><img src="images/licence/ogl-symbol-41px-retina-black.png"></img></a>
                        <p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon">Open Government Licence v3.0</a>, except where otherwise stated</p>
                    </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99659472-1', 'auto');
  ga('send', 'pageview');

</script>

 


</body>

</html>
